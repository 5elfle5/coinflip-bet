!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var r=0;function e(n){return n(this)}function t(n,r,e){return r(this,"function"==typeof e?e(n(this)):e)}function a(n,r){(null==r||r>n.length)&&(r=n.length);for(var e=0,t=Array(r);e<r;e++)t[e]=n[e];return t}function o(n,r){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,r){if(n){if("string"==typeof n)return a(n,r);var e={}.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?a(n,r):void 0}}(n))||r){e&&(n=e);var t=0;return function(){return t>=n.length?{done:!0}:{done:!1,value:n[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=function(n,r){return n.unstable_is?n.unstable_is(r):r===n},f=function(n){return"init"in n},l=function(n){return!!n.write},c=new WeakMap,v=function(n){var r;return d(n)&&!(null!=(r=c.get(n))&&r[1])},d=function(n){return"function"==typeof(null==n?void 0:n.then)},s=function(n){return"v"in n||"e"in n},y=function(n){if("e"in n)throw n.e;return n.v},p=function(n,r,e){e.p.has(n)||(e.p.add(n),r.then((function(){e.p.delete(n)}),(function(){e.p.delete(n)})))},h=function(n,r,e,t,a){var o;e.d.set(t,a.n),v(e.v)&&p(r,e.v,a),null==(o=a.m)||o.t.add(r),n&&b(n,t,r)},m=function(){return{D:new Map,H:new Set,M:new Set,L:new Set}},w=function(n,r,e){n[r].add(e)},g=function(n,r,e){n.D.has(r)||(n.D.set(r,new Set),w(n,"M",(function(){var r;null==(r=e.m)||r.l.forEach((function(r){return w(n,"M",r)}))})))},b=function(n,r,e){var t=n.D.get(r);t&&t.add(e)},S=function(n){for(var r,e=!1,t=function(n){try{n()}catch(n){e||(r=n,e=!0)}};n.H.size||n.M.size||n.L.size;)n.D.clear(),n.H.forEach(t),n.H.clear(),n.M.forEach(t),n.M.clear(),n.L.forEach(t),n.L.clear();if(e)throw r},A=function(){for(var n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];var t=r[0],a=r[1],i=r[2],b=r[3],M=function(n,r,e){var a,i,u,f="v"in r,l=r.v,s=v(r.v)?r.v:null;if(d(e)){!function(n){if(!c.has(n)){var r=[new Set,!1];c.set(n,r);var e=function(){r[1]=!0};n.then(e,e),n.onCancel=function(n){r[0].add(n)}}}(e);for(var y,h=o(r.d.keys());!(y=h()).done;){var m=y.value;p(n,e,t(m))}r.v=e}else r.v=e;delete r.e,delete r.x,f&&Object.is(l,r.v)||(++r.n,s&&(a=s,i=e,(u=c.get(a))&&(u[1]=!0,u[0].forEach((function(n){return n(i)})))))},k=function(n,r){var e=t(r);if(s(e)){if(e.m&&!e.x)return e;if(Array.from(e.d).every((function(r){var e=r[0],t=r[1];return k(n,e).n===t})))return e}e.d.clear();var o,i,c=!0,v={get signal(){return o||(o=new AbortController),o.signal},get setSelf(){return!i&&l(r)&&(i=function(){if(!c){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return D.apply(void 0,[r].concat(e))}}),i}};try{var p=a(r,(function(a){if(u(r,a)){var o=t(a);if(!s(o)){if(!f(a))throw new Error("no atom init");M(a,o,a.init)}return y(o)}var i=k(n,a);try{return y(i)}finally{if(c)h(n,r,e,a,i);else{var l=m();h(l,r,e,a,i),L(l,r,e),S(l)}}}),v);if(M(r,e,p),d(p)){null==p.onCancel||p.onCancel((function(){var n;return null==(n=o)?void 0:n.abort()}));var w=function(){if(e.m){var n=m();L(n,r,e),S(n)}};p.then(w,w)}return e}catch(n){return delete e.v,e.e=n,delete e.x,++e.n,e}finally{c=!1}},x=function(n,r,e){for(var a,i,u=new Map,f=o((null==(l=e.m)?void 0:l.t)||[]);!(i=f()).done;){var l,c=i.value,v=t(c);v.m&&u.set(c,v)}for(var d,s=o(e.p);!(d=s()).done;){var y=d.value;u.set(y,t(y))}return null==(a=function(n,r){return n.D.get(r)}(n,r))||a.forEach((function(n){u.set(n,t(n))})),u},E=function(n,r){var e=!0;try{for(var a=arguments.length,l=new Array(a>2?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];return i.apply(void 0,[r,function(r){return y(k(n,r))},function(a){var i=t(a);try{for(var l=arguments.length,c=new Array(l>1?l-1:0),v=1;v<l;v++)c[v-1]=arguments[v];if(u(r,a)){if(!f(a))throw new Error("atom not writable");var d=i.n,s=c[0];return M(a,i,s),L(n,a,i),void(d!==i.n&&(g(n,a,i),function(n,r,e){for(var t=[],a=new Set,i=new Set,u=[[r,e]];u.length>0;){var f=u[u.length-1],l=f[0],c=f[1];if(i.has(l))u.pop();else if(a.has(l))t.push([l,c,c.n]),i.add(l),c.x=!0,u.pop();else{a.add(l);for(var v,d=o(x(n,l,c));!(v=d()).done;){var s=v.value,y=s[0],p=s[1];l===y||a.has(y)||u.push([y,p])}}}w(n,"H",(function(){for(var e=new Set([r]),a=t.length-1;a>=0;--a){for(var i,u=t[a],f=u[0],l=u[1],c=u[2],v=!1,d=o(l.d.keys());!(i=d()).done;){var s=i.value;if(s!==f&&e.has(s)){v=!0;break}}v&&(k(n,f),L(n,f,l),c!==l.n&&(g(n,f,l),e.add(f))),delete l.x}}))}(n,a,i)))}return E.apply(void 0,[n,a].concat(c))}finally{e||S(n)}}].concat(l))}finally{e=!1}},D=function(n){var r=m();try{for(var e=arguments.length,t=new Array(e>1?e-1:0),a=1;a<e;a++)t[a-1]=arguments[a];return E.apply(void 0,[r,n].concat(t))}finally{S(r)}},L=function(n,r,e){if(e.m&&!v(e.v)){for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;if(!e.m.d.has(u))j(n,u,t(u)).t.add(r),e.m.d.add(u)}for(var f,l=o(e.m.d||[]);!(f=l()).done;){var c=f.value;if(!e.d.has(c)){e.m.d.delete(c);var d=C(n,c,t(c));null==d||d.t.delete(r)}}}},j=function(n,r,e){if(!e.m){k(n,r);for(var a,i=o(e.d.keys());!(a=i()).done;){var u=a.value;j(n,u,t(u)).t.add(r)}if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},l(r)){var f,c=e.m,v=function(n,e){var t=!0;f=function(){try{for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return E.apply(void 0,[n,r].concat(a))}finally{t||S(n)}};try{return e()}finally{t=!1}};w(n,"L",(function(){var e=v(n,(function(){return b(r,(function(){return f.apply(void 0,arguments)}))}));e&&(c.u=function(n){return v(n,e)})}))}}return e.m},C=function(n,r,e){if(!e.m||e.m.l.size||Array.from(e.m.t).some((function(n){var e;return null==(e=t(n).m)?void 0:e.d.has(r)})))return e.m;var a=e.m.u;a&&w(n,"L",(function(){return a(n)})),delete e.m;for(var i,u=o(e.d.keys());!(i=u()).done;){var f=i.value,l=C(n,f,t(f));null==l||l.t.delete(r)}},H={get:function(n){return y(k(void 0,n))},set:D,sub:function(n,r){var e=m(),a=t(n),o=j(e,n,a).l;return o.add(r),S(e),function(){o.delete(r);var e=m();C(e,n,a),S(e)}},unstable_derive:function(n){return A.apply(void 0,n(t,a,i,b))}};return H},M=function(){var n=new WeakMap,r=A((function(r){var e=n.get(r);return e||(e={d:new Map,p:new Set,n:0},n.set(r,e)),e}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.read.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return n.write.apply(n,e)}),(function(n){for(var r=arguments.length,e=new Array(r>1?r-1:0),t=1;t<r;t++)e[t-1]=arguments[t];return null==n.onMount?void 0:n.onMount.apply(n,e)}));return r};n.atom=function(n,a){var o="atom"+ ++r,i={toString:function(){return o}};return"function"==typeof n?i.read=n:(i.init=n,i.read=e,i.write=t),a&&(i.write=a),i},n.createStore=M,n.getDefaultStore=function(){return i||(i=M()),i}}));
