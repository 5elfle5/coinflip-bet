import{u as b,b as m,j as e}from"./tanstack-BbfzrFXC.js";import{u as h,g as N,h as x,E as y,e as j,A as v,W as w}from"./index-DcW_LoIp.js";import{P as C,e as P,K as A}from"./coral-CEYAF2_Q.js";import{r as f}from"./jotai-BbwHuUxQ.js";import{k as K}from"./reactHotToast-DzJy1beG.js";import{u as M,a as F}from"./solanaWalletAdapters-BZ_vhvm0.js";import"./react-DigmodT6.js";import"./reactRouter-IUhfY1Hp.js";import"./tabler-CLQ0WwGZ.js";const S="coUnmi3oBUtwtd9fjeAvSsJssXh5A5xyPbhpewyzRVF",k={name:"coinflipbet",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},I=[{name:"close",discriminator:[98,165,201,177,108,65,206,96],accounts:[{name:"payer",writable:!0,signer:!0},{name:"coinflipbet",writable:!0}],args:[]},{name:"decrement",discriminator:[106,227,168,59,248,27,150,101],accounts:[{name:"coinflipbet",writable:!0}],args:[]},{name:"increment",discriminator:[11,18,104,9,104,174,59,33],accounts:[{name:"coinflipbet",writable:!0}],args:[]},{name:"initialize",discriminator:[175,175,109,31,13,152,155,237],accounts:[{name:"payer",writable:!0,signer:!0},{name:"coinflipbet",writable:!0,signer:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[]},{name:"set",discriminator:[198,51,53,241,116,29,126,194],accounts:[{name:"coinflipbet",writable:!0}],args:[{name:"value",type:"u8"}]}],z=[{name:"Coinflipbet",discriminator:[255,176,4,245,188,253,124,25]}],L=[{name:"Coinflipbet",type:{kind:"struct",fields:[{name:"count",type:"u8"}]}}],g={address:S,metadata:k,instructions:I,accounts:z,types:L},q=new C(g.address);function E(t,n){return new P({...g,address:n?n.toBase58():g.address},t)}function T(t){switch(t){case"devnet":case"testnet":return new C("coUnmi3oBUtwtd9fjeAvSsJssXh5A5xyPbhpewyzRVF");case"mainnet-beta":default:return q}}function p(){const{connection:t}=M(),{cluster:n}=h(),a=x(),s=N(),r=f.useMemo(()=>T(n.network),[n]),i=f.useMemo(()=>E(s,r),[s,r]),l=b({queryKey:["coinflipbet","all",{cluster:n}],queryFn:()=>i.account.coinflipbet.all()}),u=b({queryKey:["get-program-account",{cluster:n}],queryFn:()=>t.getParsedAccountInfo(r)}),o=m({mutationKey:["coinflipbet","initialize",{cluster:n}],mutationFn:d=>i.methods.initialize().accounts({coinflipbet:d.publicKey}).signers([d]).rpc(),onSuccess:d=>(a(d),l.refetch()),onError:()=>K.error("Failed to initialize account")});return{program:i,programId:r,accounts:l,getProgramAccount:u,initialize:o}}function B({account:t}){const{cluster:n}=h(),a=x(),{program:s,accounts:r}=p(),i=b({queryKey:["coinflipbet","fetch",{cluster:n,account:t}],queryFn:()=>s.account.coinflipbet.fetch(t)}),l=m({mutationKey:["coinflipbet","close",{cluster:n,account:t}],mutationFn:()=>s.methods.close().accounts({coinflipbet:t}).rpc(),onSuccess:c=>(a(c),r.refetch())}),u=m({mutationKey:["coinflipbet","decrement",{cluster:n,account:t}],mutationFn:()=>s.methods.decrement().accounts({coinflipbet:t}).rpc(),onSuccess:c=>(a(c),i.refetch())}),o=m({mutationKey:["coinflipbet","increment",{cluster:n,account:t}],mutationFn:()=>s.methods.increment().accounts({coinflipbet:t}).rpc(),onSuccess:c=>(a(c),i.refetch())}),d=m({mutationKey:["coinflipbet","set",{cluster:n,account:t}],mutationFn:c=>s.methods.set(c).accounts({coinflipbet:t}).rpc(),onSuccess:c=>(a(c),i.refetch())});return{accountQuery:i,closeMutation:l,decrementMutation:u,incrementMutation:o,setMutation:d}}function R(){const{initialize:t}=p();return e.jsxs("button",{className:"btn btn-xs lg:btn-md btn-primary",onClick:()=>t.mutateAsync(A.generate()),disabled:t.isPending,children:["Create ",t.isPending&&"..."]})}function U(){var a,s,r;const{accounts:t,getProgramAccount:n}=p();return n.isLoading?e.jsx("span",{className:"loading loading-spinner loading-lg"}):(a=n.data)!=null&&a.value?e.jsx("div",{className:"space-y-6",children:t.isLoading?e.jsx("span",{className:"loading loading-spinner loading-lg"}):(s=t.data)!=null&&s.length?e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:(r=t.data)==null?void 0:r.map(i=>e.jsx(D,{account:i.publicKey},i.publicKey.toString()))}):e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl",children:"No accounts"}),"No accounts found. Create one above to get started."]})}):e.jsx("div",{className:"alert alert-info flex justify-center",children:e.jsx("span",{children:"Program account not found. Make sure you have deployed the program and are on the correct cluster."})})}function D({account:t}){var u;const{accountQuery:n,incrementMutation:a,setMutation:s,decrementMutation:r,closeMutation:i}=B({account:t}),l=f.useMemo(()=>{var o;return((o=n.data)==null?void 0:o.count)??0},[(u=n.data)==null?void 0:u.count]);return n.isLoading?e.jsx("span",{className:"loading loading-spinner loading-lg"}):e.jsx("div",{className:"card card-bordered border-base-300 border-4 text-neutral-content",children:e.jsx("div",{className:"card-body items-center text-center",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"card-title justify-center text-3xl cursor-pointer",onClick:()=>n.refetch(),children:l}),e.jsxs("div",{className:"card-actions justify-around",children:[e.jsx("button",{className:"btn btn-xs lg:btn-md btn-outline",onClick:()=>a.mutateAsync(),disabled:a.isPending,children:"Increment"}),e.jsx("button",{className:"btn btn-xs lg:btn-md btn-outline",onClick:()=>{const o=window.prompt("Set value to:",l.toString()??"0");if(!(!o||parseInt(o)===l||isNaN(parseInt(o))))return s.mutateAsync(parseInt(o))},disabled:s.isPending,children:"Set"}),e.jsx("button",{className:"btn btn-xs lg:btn-md btn-outline",onClick:()=>r.mutateAsync(),disabled:r.isPending,children:"Decrement"})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{children:e.jsx(y,{path:`account/${t}`,label:j(t.toString())})}),e.jsx("button",{className:"btn btn-xs btn-secondary btn-outline",onClick:()=>{if(window.confirm("Are you sure you want to close this account?"))return i.mutateAsync()},disabled:i.isPending,children:"Close"})]})]})})})}function H(){const{publicKey:t}=F(),{programId:n}=p();return t?e.jsxs("div",{children:[e.jsxs(v,{title:"Coinflipbet",subtitle:`Create a new account by clicking the "Create" button. The state of a account is stored on-chain and can be manipulated by calling the program's methods (increment, decrement, set, and close).`,children:[e.jsx("p",{className:"mb-6",children:e.jsx(y,{path:`account/${n}`,label:j(n.toString())})}),e.jsx(R,{})]}),e.jsx(U,{})]}):e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"hero py-[64px]",children:e.jsx("div",{className:"hero-content text-center",children:e.jsx(w,{})})})})}export{H as default};
